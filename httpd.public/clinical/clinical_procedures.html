<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Clinical Procedures & SMUR ‚Äî Pilot Mockup</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --panel:#111827; /* gray-900 */
      --panel-2:#0b1222;
      --card:#111827;
      --muted:#94a3b8; /* slate-400 */
      --muted-2:#64748b; /* slate-500 */
      --text:#e5e7eb; /* gray-200 */
      --brand:#60a5fa; /* blue-400 */
      --brand-2:#3b82f6; /* blue-500 */
      --accent:#22d3ee; /* cyan-400 */
      --danger:#ef4444; /* red-500 */
      --ok:#22c55e; /* green-500 */
      --shadow: 0 10px 25px rgba(0,0,0,0.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:radial-gradient(1200px 600px at 10% -10%, #1d2845, transparent 60%), radial-gradient(900px 500px at 110% 10%, #1a2e28, transparent 60%), var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";}
    a{color:var(--brand)}
    .app{
      max-width:420px; margin:24px auto; padding:0; border-radius:24px; background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); box-shadow:var(--shadow); border:1px solid rgba(255,255,255,0.08); overflow:hidden; position:relative;
    }
    .statusbar{height:14px; background:rgba(255,255,255,0.06)}
    .topbar{
      display:flex; align-items:center; gap:12px; padding:14px 16px; background:rgba(17,24,39,0.8); backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,0.08); position:sticky; top:0; z-index:20;
    }
    .iconbtn{ width:36px; height:36px; display:grid; place-items:center; border-radius:12px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08); cursor:pointer; user-select:none}
    .title{ font-weight:700; letter-spacing:.2px}
    .spacer{flex:1}
    .screen{ display:none; min-height:680px; padding:16px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    .screen.active{ display:block}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.08);
      border-radius:16px; padding:14px; margin:10px 0;
    }
    .feed-item{ display:flex; gap:12px; align-items:flex-start}
    .badge{ font-size:12px; color:#0b1222; background:linear-gradient(90deg, var(--accent), var(--brand)); padding:2px 8px; border-radius:99px; font-weight:700; }
    .muted{ color:var(--muted); font-size:13px}
    .subtitle{ color:var(--muted-2); font-size:13px}
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .quick{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin-top:8px}
    .quick .tile{ text-align:center; padding:12px 8px; border-radius:14px; border:1px solid rgba(255,255,255,0.08); background:rgba(255,255,255,0.04); cursor:pointer}
    .searchbar{ display:flex; gap:8px; padding:10px; border-radius:14px; background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.1); align-items:center}
    input[type="text"], input[type="email"], input[type="password"], select{
      width:100%; background:transparent; border:0; outline:none; color:var(--text); font-size:15px;
    }
    .list{ display:grid; gap:8px}
    .list .item{ padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.08); background:rgba(255,255,255,0.04); display:flex; justify-content:space-between; align-items:center; cursor:pointer}
    .grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap:10px}
    .grid .card{ min-height:92px; display:flex; flex-direction:column; justify-content:center; align-items:flex-start; cursor:pointer}
    .pill{padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.06); font-size:12px}
    .footer-meta{ margin-top:14px; border-top:1px dashed rgba(255,255,255,0.1); padding-top:10px; color:var(--muted); font-size:12px}
    .heart{ cursor:pointer; user-select:none; font-size:20px}
    .tags{display:flex; gap:6px; flex-wrap:wrap; margin-top:6px}
    .toast{ position:fixed; left:50%; bottom:24px; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:#fff; padding:10px 14px; border-radius:10px; display:none; z-index:50}
    .drawer{ position:absolute; top:0; left:0; bottom:0; width:280px; background:rgba(15,23,42,0.98); border-right:1px solid rgba(255,255,255,0.08); transform:translateX(-100%); transition:transform .2s ease; z-index:40}
    .drawer.open{ transform:translateX(0)}
    .drawer h3{ margin:16px 16px 6px 16px; font-size:14px; color:var(--muted)}
    .drawer a{ display:block; padding:12px 16px; text-decoration:none; color:var(--text); border-radius:10px; margin:4px 8px}
    .drawer a:hover{ background:rgba(255,255,255,0.06)}
    .overlay{ position:absolute; inset:0; background:rgba(0,0,0,0.3); display:none; z-index:30}
    .overlay.show{ display:block}
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,0.12); background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      color:var(--text); border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600
    }
    .btn.primary{ border-color: transparent; background:linear-gradient(90deg, var(--brand-2), var(--accent)); color:#0b1222}
    .loginhero{ margin:40px 0 20px; text-align:center}
    .loginhero h1{ margin:0 0 10px}
    .loginhero p{ color:var(--muted)}
    .label{ font-size:12px; color:var(--muted); margin:10px 4px 6px}
    .imgph{ width:100%; height:160px; border-radius:12px; border:1px dashed rgba(255,255,255,0.15); background:repeating-linear-gradient(45deg, rgba(255,255,255,0.04) 0, rgba(255,255,255,0.04) 10px, rgba(255,255,255,0.06) 10px, rgba(255,255,255,0.06) 20px); display:grid; place-items:center; color:var(--muted)}
    .inline-link{ color:var(--accent); cursor:pointer; text-decoration:underline}
    .section-title{ margin:6px 0 6px; font-size:14px; color:var(--muted)}
    .kicker{ font-size:12px; text-transform:uppercase; letter-spacing:.12em; color:var(--muted); margin-bottom:6px}
    .avatar{ width:36px; height:36px; border-radius:10px; background:linear-gradient(135deg, #1e293b, #0b1222); border:1px solid rgba(255,255,255,0.08); display:grid; place-items:center; font-weight:700; color:var(--brand)}
    .sr{ position:absolute; left:-9999px}
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="statusbar" aria-hidden="true"></div>
    <div class="topbar">
      <div class="iconbtn" id="btnMenu" title="Menu" aria-label="Open menu">‚ò∞</div>
      <div class="title">ED Procedures</div>
      <div class="spacer"></div>
      <div class="iconbtn" id="btnSearch" title="Search" aria-label="Search">üîé</div>
      <div class="iconbtn" id="btnFav" title="Favorites" aria-label="Favorites">‚≠ê</div>
    </div>

    <!-- Drawer -->
    <div class="drawer" id="drawer">
      <h3>Navigate</h3>
      <a href="#" data-nav="home">üè† Home</a>
      <a href="#" data-nav="procedures">üìö Procedures</a>
      <a href="#" data-nav="smur">üöë SMUR</a>
      <a href="#" data-nav="favorites">‚≠ê Favorites</a>
      <h3>Browse by system</h3>
      <a href="#" data-filter-system="Cardiac">Cardiac</a>
      <a href="#" data-filter-system="Respiratory">Respiratory</a>
      <a href="#" data-filter-system="Metabolic">Metabolic</a>
      <h3>Settings</h3>
      <a href="#" data-nav="settings">‚öôÔ∏è Preferences</a>
      <div class="kicker" style="margin:16px">Pilot mockup ‚Ä¢ no real medical content</div>
    </div>
    <div class="overlay" id="overlay"></div>

    <!-- Screens -->
    <div class="screen active" id="screen-login" role="region" aria-label="Login screen">
      <div class="loginhero">
        <div class="avatar" style="margin:0 auto 10px">ED</div>
        <h1>Clinical Procedures & SMUR</h1>
        <p>Pilot app ‚Äî password login only</p>
      </div>
      <div class="card">
        <div class="label">Email</div>
        <div class="searchbar"><input type="email" id="email" placeholder="name@hospital.org" value="demo@hospital.org" aria-label="Email"></div>
        <div class="label">Password</div>
        <div class="searchbar"><input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="password" aria-label="Password"></div>
        <div class="row" style="margin-top:12px; justify-content:space-between">
          <button class="btn" id="btnDemoFill">Use demo account</button>
          <button class="btn primary" id="btnLogin">Log in</button>
        </div>
      </div>
      <div class="muted" style="margin:10px 4px">By continuing you agree to the pilot terms. No patient data is stored. Content shown is fictitious for design purposes.</div>
    </div>

    <div class="screen" id="screen-home" role="region" aria-label="Home">
      <div class="card">
        <div class="searchbar">
          <span>üîé</span>
          <input id="inputSearch" type="text" placeholder="Search procedures, e.g., bradycardia" aria-label="Search">
        </div>
        <div class="quick">
          <div class="tile" data-nav="procedures">üìö Procedures</div>
          <div class="tile" data-nav="smur">üöë SMUR</div>
          <div class="tile" data-nav="favorites">‚≠ê Favorites</div>
        </div>
      </div>

      <div class="section-title">Latest updates</div>
      <div id="feed"></div>
    </div>

    <div class="screen" id="screen-procedures" role="region" aria-label="Procedures list">
      <div class="row" style="margin-bottom:8px">
        <div class="pill" id="pillAll">All</div>
        <div class="pill" data-type="general">General</div>
        <div class="pill" data-type="smur">SMUR</div>
      </div>
      <div class="list" id="procList"></div>
    </div>

    <div class="screen" id="screen-detail" role="region" aria-label="Procedure detail">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div>
            <div class="kicker" id="detailType"></div>
            <h2 id="detailTitle" style="margin:4px 0 6px"></h2>
            <div class="subtitle" id="detailSystem"></div>
          </div>
          <div class="heart" id="btnHeart" title="Add to favorites" aria-label="Add to favorites">‚ô°</div>
        </div>
        <div class="tags" id="detailTags"></div>
        <div class="imgph" aria-hidden="true">Image placeholder</div>
        <div id="detailContent" style="margin-top:10px; line-height:1.55"></div>
        <div class="footer-meta" id="detailMeta"></div>
      </div>
    </div>

    <div class="screen" id="screen-smur" role="region" aria-label="SMUR home">
      <div class="grid" id="smurGrid"></div>
    </div>

    <div class="screen" id="screen-favorites" role="region" aria-label="Favorites">
      <div class="list" id="favList"></div>
    </div>

    <div class="screen" id="screen-settings" role="region" aria-label="Settings">
      <div class="card">
        <div class="label">Select hospital</div>
        <div class="searchbar">
          <select id="selHospital" aria-label="Hospital selector">
            <option value="H1">H1 ‚Äî University Hospital</option>
            <option value="H2">H2 ‚Äî Community Hospital</option>
          </select>
        </div>
        <div class="row" style="margin-top:10px; gap:8px">
          <button class="btn" id="btnDownload">Download all for offline</button>
          <button class="btn" id="btnClear">Clear cache</button>
        </div>
      </div>
      <div class="card">
        <div class="label">About</div>
        <div class="muted">Pilot mockup ‚Ä¢ v0.1 ‚Ä¢ No patient data ‚Ä¢ Content is fictitious and not medical advice.</div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast" role="status" aria-live="polite"></div>
  </div>

  <script>
    // --- Mock Data ---
    const procedures = [
      {
        id:"p1",
        slug:"bradycardia",
        title:"Bradycardia",
        type:"general",
        system:"Cardiac",
        category:"ACLS",
        tags:["arrhythmia","ECG","emergency"],
        createdAt:"2025-03-02",
        lastUpdatedAt:"2025-09-10",
        summary:"Initial assessment and stabilization steps for adult bradycardia.",
        bodyBase:`<p><strong>Initial assessment:</strong> Airway, breathing, circulation. Attach monitors.</p>
                  <p>If symptomatic, follow local protocol. Consider reversible causes such as <span class="inline-link" data-link="hypokalaemia">hypokalaemia</span>.</p>
                  <p class="muted">All doses/flows are placeholders in this mockup. Use approved hospital protocol in production.</p>`,
        variants:{
          "H1": { // University Hospital
            note:"H1 variant: local pacing and medication blocks differ (placeholder).",
            blocks:[{ key:"local_policy", html:`<p><em>H1 policy:</em> See Bradycardia algorithm step 3 (placeholder).</p>` }]
          },
          "H2": { // Community Hospital
            note:"H2 variant: streamlined initial steps (placeholder).",
            blocks:[{ key:"local_policy", html:`<p><em>H2 policy:</em> Use simplified evaluation checklist (placeholder).</p>` }]
          }
        }
      },
      {
        id:"p2",
        slug:"hypokalaemia",
        title:"Hypokalaemia",
        type:"general",
        system:"Metabolic",
        category:"Electrolytes",
        tags:["potassium","electrolyte"],
        createdAt:"2025-04-11",
        lastUpdatedAt:"2025-08-05",
        summary:"Evaluation of low serum potassium and supportive measures.",
        bodyBase:`<p><strong>Overview:</strong> Identify severity and potential causes. Telemetry if indicated.</p>
                  <p>Check magnesium and address contributing factors. This is placeholder content.</p>`,
        variants:{
          "H1": { note:"H1: monitoring thresholds differ (placeholder).", blocks:[] },
          "H2": { note:"H2: IV vs PO criteria differ (placeholder).", blocks:[] }
        }
      },
      {
        id:"p3",
        slug:"anaphylaxis-smur",
        title:"Anaphylaxis (SMUR)",
        type:"smur",
        system:"Respiratory",
        category:"Allergy",
        tags:["prehospital","airway"],
        createdAt:"2025-02-01",
        lastUpdatedAt:"2025-09-14",
        summary:"Recognition and immediate actions in the field (placeholder).",
        bodyBase:`<p><strong>Recognition:</strong> Rapid onset skin, airway, breathing, circulation changes.</p>
                  <p>Immediate actions per local protocol (placeholder). Transport decision making.</p>`,
        variants:{ "H1":{note:"H1 field kit layout (placeholder).", blocks:[]}, "H2":{note:"H2 ambulance checklist (placeholder).", blocks:[]} }
      },
      {
        id:"p4",
        slug:"airway-basic",
        title:"Airway ‚Äì Basic (SMUR)",
        type:"smur",
        system:"Respiratory",
        category:"Airway",
        tags:["airway","bag-mask"],
        createdAt:"2025-01-05",
        lastUpdatedAt:"2025-07-22",
        summary:"Opening maneuvers and bag-mask ventilation (placeholder).",
        bodyBase:`<p><strong>Positioning:</strong> Head tilt, chin lift if appropriate.</p>
                  <p>Bag-mask technique per training. Placeholder only.</p>`,
        variants:{ "H1":{note:"H1 adjunct selection (placeholder).", blocks:[]}, "H2":{note:"H2 adjunct selection (placeholder).", blocks:[]} }
      }
    ];

    // --- State ---
    const state = {
      loggedIn:false,
      hospital: localStorage.getItem('hospital') || 'H1',
      favorites: JSON.parse(localStorage.getItem('favorites')||'[]')
    };

    // --- Helpers ---
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    function toast(msg){ const t=$("#toast"); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none', 1800); }
    function showScreen(id){
      $$(".screen").forEach(s=>s.classList.remove('active'));
      $(id).classList.add('active');
      // Close drawer if open
      $("#drawer").classList.remove('open'); $("#overlay").classList.remove('show');
      // Update header buttons visibility
      const isLogin = id==="#screen-login";
      $("#btnMenu").style.visibility = isLogin ? "hidden":"visible";
      $("#btnSearch").style.visibility = isLogin ? "hidden":"visible";
      $("#btnFav").style.visibility = isLogin ? "hidden":"visible";
    }
    function formatDate(d){ return new Date(d).toLocaleDateString(undefined, {year:'numeric', month:'short', day:'2-digit'}); }
    function isFav(id){ return state.favorites.includes(id); }
    function toggleFav(id){
      const i = state.favorites.indexOf(id);
      if(i>=0) state.favorites.splice(i,1); else state.favorites.push(id);
      localStorage.setItem('favorites', JSON.stringify(state.favorites));
    }
    function sortedLatest(list){
      return [...list].sort((a,b)=> new Date(b.lastUpdatedAt) - new Date(a.lastUpdatedAt));
    }
    function accentInsensitiveSort(a,b){ return a.title.localeCompare(b.title, 'fr', {sensitivity:'base'}); }

    // --- Rendering ---
    function renderHome(){
      const feedEl = $("#feed"); feedEl.innerHTML='';
      const latest = sortedLatest(procedures).slice(0,5);
      latest.forEach(p=>{
        const el = document.createElement('div');
        el.className="card feed-item";
        el.innerHTML = `
          <div class="avatar">${p.type==='smur' ? 'üöë' : 'üìÑ'}</div>
          <div style="flex:1">
            <div class="row" style="justify-content:space-between">
              <div style="font-weight:700">${p.title}</div>
              <div class="badge">Updated</div>
            </div>
            <div class="subtitle">${p.system} ‚Ä¢ ${p.category}</div>
            <div class="muted">Last updated ${formatDate(p.lastUpdatedAt)}</div>
          </div>
        `;
        el.addEventListener('click', ()=>openDetail(p.id));
        feedEl.appendChild(el);
      });
    }

    function renderProcedures(filterType=null, system=null){
      const listEl = $("#procList"); listEl.innerHTML='';
      let list = procedures;
      if(filterType) list = list.filter(p=>p.type===filterType);
      if(system) list = list.filter(p=>p.system===system);
      list = list.sort((a,b)=> a.title.localeCompare(b.title, 'fr', {sensitivity:'base'}));
      list.forEach(p=>{
        const el = document.createElement('div'); el.className="item";
        el.innerHTML = `
          <div>
            <div style="font-weight:700">${p.title}</div>
            <div class="subtitle">${p.type==='smur'?'SMUR':'General'} ‚Ä¢ ${p.system}</div>
          </div>
          <div>‚Ä∫</div>`;
        el.addEventListener('click', ()=>openDetail(p.id));
        listEl.appendChild(el);
      });
    }

    function renderSmur(){
      const grid = $("#smurGrid"); grid.innerHTML='';
      const list = procedures.filter(p=>p.type==='smur').sort(accentInsensitiveSort);
      list.forEach(p=>{
        const el = document.createElement('div'); el.className="card";
        el.innerHTML = `<div class="kicker">SMUR</div><div style="font-weight:700">${p.title}</div><div class="muted" style="margin-top:6px">${p.system}</div>`;
        el.addEventListener('click', ()=>openDetail(p.id));
        grid.appendChild(el);
      });
    }

    function renderFavorites(){
      const list = procedures.filter(p=> state.favorites.includes(p.id));
      const container = $("#favList"); container.innerHTML='';
      if(!list.length){ container.innerHTML='<div class="muted">No favorites yet.</div>'; return;}
      list.forEach(p=>{
        const el = document.createElement('div'); el.className="item";
        el.innerHTML = `<div><div style="font-weight:700">${p.title}</div><div class="subtitle">${p.type==='smur'?'SMUR':'General'} ‚Ä¢ ${p.system}</div></div><div>‚òÖ</div>`;
        el.addEventListener('click', ()=>openDetail(p.id));
        container.appendChild(el);
      });
    }

    function mergeVariant(p){
      const v = (p.variants && p.variants[state.hospital]) || null;
      let html = p.bodyBase;
      if(v && v.blocks && v.blocks.length){
        // append variant note and blocks for demo
        html += `<div class="card" style="margin-top:10px"><div class="kicker">Hospital variant</div><div class="muted">${v.note || 'Variant content'}</div>`;
        v.blocks.forEach(b=> html += `<div style="margin-top:6px">${b.html}</div>`);
        html += `</div>`;
      }else{
        html += `<div class="card" style="margin-top:10px"><div class="kicker">Hospital variant</div><div class="muted">No specific variant for ${state.hospital}. Showing base content.</div></div>`;
      }
      return html;
    }

    function openDetail(id){
      const p = procedures.find(x=>x.id===id); if(!p) return;
      $("#detailTitle").textContent = p.title;
      $("#detailType").textContent = p.type==='smur' ? 'SMUR' : 'General procedure';
      $("#detailSystem").textContent = `${p.system} ‚Ä¢ ${p.category}`;
      $("#detailContent").innerHTML = mergeVariant(p);
      $("#detailMeta").innerHTML = `
        <div>Created: ${formatDate(p.createdAt)} ‚Ä¢ Last updated: ${formatDate(p.lastUpdatedAt)} ‚Ä¢ Version: demo</div>
        <div class="muted">This mockup is for design only and not medical advice.</div>`;
      $("#btnHeart").textContent = isFav(p.id) ? '‚ô•' : '‚ô°';
      $("#btnHeart").onclick = ()=>{ toggleFav(p.id); $("#btnHeart").textContent = isFav(p.id)?'‚ô•':'‚ô°'; toast(isFav(p.id)?'Added to favorites':'Removed from favorites'); };
      // Inline cross-links
      $("#detailContent").querySelectorAll('.inline-link').forEach(a=>{
        a.addEventListener('click', ()=>{
          const slug = a.getAttribute('data-link');
          const target = procedures.find(x=>x.slug===slug);
          if(target) openDetail(target.id);
        });
      });
      showScreen("#screen-detail");
    }

    function runSearch(q){
      const results = procedures.filter(p=> (p.title + ' ' + p.summary + ' ' + p.tags.join(' ')).toLowerCase().includes(q.toLowerCase()));
      $("#procList").innerHTML='';
      if(!results.length){ $("#procList").innerHTML = '<div class="muted">No results.</div>'; return;}
      results.sort((a,b)=> a.title.localeCompare(b.title, 'fr', {sensitivity:'base'}))
        .forEach(p=>{
          const el = document.createElement('div'); el.className="item";
          el.innerHTML = `<div><div style="font-weight:700">${p.title}</div><div class="subtitle">${p.type==='smur'?'SMUR':'General'} ‚Ä¢ ${p.system}</div></div><div>‚Ä∫</div>`;
          el.addEventListener('click', ()=>openDetail(p.id));
          $("#procList").appendChild(el);
        });
      showScreen("#screen-procedures");
    }

    // --- Event wiring ---
    function init(){
      // Header buttons
      $("#btnMenu").onclick = ()=>{ $("#drawer").classList.add('open'); $("#overlay").classList.add('show'); };
      $("#overlay").onclick = ()=>{ $("#drawer").classList.remove('open'); $("#overlay").classList.remove('show'); };
      $("#btnFav").onclick = ()=>{ renderFavorites(); showScreen("#screen-favorites"); };
      $("#btnSearch").onclick = ()=>{ $("#inputSearch").focus(); showScreen("#screen-home"); };

      // Drawer nav
      $$("#drawer a[data-nav]").forEach(a=> a.addEventListener('click', e=>{
        e.preventDefault();
        const nav = a.getAttribute('data-nav');
        if(nav==='home'){ renderHome(); showScreen("#screen-home"); }
        if(nav==='procedures'){ renderProcedures(); showScreen("#screen-procedures"); }
        if(nav==='smur'){ renderSmur(); showScreen("#screen-smur"); }
        if(nav==='favorites'){ renderFavorites(); showScreen("#screen-favorites"); }
        if(nav==='settings'){ $("#selHospital").value = state.hospital; showScreen("#screen-settings"); }
      }));
      $$("#drawer a[data-filter-system]").forEach(a=> a.addEventListener('click', e=>{
        e.preventDefault(); renderProcedures(null, a.getAttribute('data-filter-system')); showScreen("#screen-procedures");
      }));

      // Home quick tiles
      $$(".tile").forEach(t=> t.addEventListener('click', ()=>{
        renderProcedures(); showScreen("#screen-procedures");
      }));

      // Search actions
      $("#inputSearch").addEventListener('keydown', (e)=>{
        if(e.key==='Enter') runSearch(e.target.value);
      });

      // Filters
      $("#pillAll").onclick = ()=>{ renderProcedures(); };
      $$("#screen-procedures .pill[data-type]").forEach(p=> p.onclick = ()=> renderProcedures(p.getAttribute('data-type')) );

      // Settings
      $("#selHospital").onchange = (e)=>{
        state.hospital = e.target.value;
        localStorage.setItem('hospital', state.hospital);
        toast('Hospital set to '+ (state.hospital==='H1'?'H1 ‚Äî University Hospital':'H2 ‚Äî Community Hospital'));
      };
      $("#btnDownload").onclick = ()=> toast('Queued for offline (mock)');
      $("#btnClear").onclick = ()=>{ localStorage.clear(); state.hospital='H1'; state.favorites=[]; $("#selHospital").value='H1'; toast('Local cache cleared'); };

      // Login demo
      $("#btnDemoFill").onclick = ()=>{ $("#email").value="demo@hospital.org"; $("#password").value="password"; };
      $("#btnLogin").onclick = ()=>{
        // Fake login
        const email = $("#email").value.trim(); const pw = $("#password").value.trim();
        if(!email || !pw){ toast('Enter email and password'); return; }
        state.loggedIn = true; toast('Welcome'); renderHome(); showScreen("#screen-home");
      };

      // Start at login
      showScreen("#screen-login");
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
